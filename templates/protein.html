{% extends "base.html" %}

{% block title %}Protein {{ protein.slug }}{% endblock %}

{% block content %}
<section class="card">
  <h1>Protein {{ protein.slug }}</h1>

  <div class="share-url">
    <span>Share URL:</span>
    <input type="text" value="{{ share_url }}" readonly id="share-url-input" />
    <button type="button" onclick="copyShareUrl()">Copy</button>
  </div>
</section>

<section class="layout">
  <div class="left-panel card">
    <h2>Sequence</h2>
    <p class="sequence-help">
      Indices are 0-based. Select a start & end index, give a label + color, and save.
    </p>

    <div id="sequence-container">
      {% for aa in protein.sequence %}
        <span class="res" data-index="{{ loop.index0 }}">{{ aa }}</span>
      {% endfor %}
    </div>

    <form id="annotation-form">
      <div class="field">
        <label for="start-index">Start index</label>
        <input type="number" id="start-index" name="start_index" min="0" max="{{ protein.sequence|length - 1 }}" required />
      </div>
      <div class="field">
        <label for="end-index">End index</label>
        <input type="number" id="end-index" name="end_index" min="0" max="{{ protein.sequence|length - 1 }}" required />
      </div>
      <div class="field">
        <label for="label">Label</label>
        <input type="text" id="label" name="label" placeholder="Active site, helix, etc." required />
      </div>
      <div class="field">
        <label for="color">Color</label>
        <input type="color" id="color" name="color" value="#ff7f0e" />
      </div>
      <button type="submit">Add annotation</button>
    </form>

    <h3>Existing annotations</h3>
    <ul id="annotation-list"></ul>
  </div>

  <div class="right-panel card">
    <h2>3D Structure</h2>
    <div id="viewport"></div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const PDB_URL = "{{ pdb_url }}";
  const PROTEIN_SLUG = "{{ protein.slug }}";
  const INITIAL_ANNOTATIONS = {{ annotations | tojson }};
</script>
<script src="/static/app.js"></script>
{% endblock %}
